<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Konfiguracja Aplikacji Mobilnej</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      width: 200px;
      height: 100vh;
      background: #eeeeee;
      padding: 20px;
      z-index: 100;
    }
    .submenu-panel {
      position: fixed;
      left: 200px;
      top: 0;
      width: 140px;
      height: 100vh;
      background: #f6f6f6;
      padding: 20px 8px;
      border-left: 1px solid #ddd;
      z-index: 101;
      display: none;
    }
    .submenu-panel.active {
      display: block;
    }
    .submenu-panel h3 {
      margin-top: 0;
      font-size: 1.1em;
      margin-bottom: 12px;
    }
    .submenu-panel a {
      display: block;
      margin-bottom: 10px;
      color: #007bff;
      text-decoration: none;
    }
    .submenu-panel a:hover {
      text-decoration: underline;
    }
    .app-container {
      transition: margin-left 0.2s;
      margin-left: 200px;
    }
    body.submenu-open .app-container {
      margin-left: 340px;
    }
    .main-content {
      padding: 20px;
      max-width: 100%;
      overflow-x: hidden;
    }
    .config-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      max-width: 100%;
    }
    .config-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid #eee;
      flex-wrap: wrap;
      gap: 10px;
    }
    .config-row:last-child {
      border-bottom: none;
    }
    .config-label {
      flex: 0 0 auto;
      font-weight: 500;
      min-width: 120px;
    }
    .config-description {
      flex: 1;
      color: #666;
      font-size: 14px;
      margin: 0 10px;
      min-width: 200px;
    }
    
    /* Responsywno≈õƒá */
    @media (max-width: 768px) {
      .config-row {
        flex-direction: column;
        align-items: flex-start;
      }
      .config-description {
        margin: 5px 0;
      }
      .toggle-container {
        margin-left: 0;
        align-self: flex-end;
      }
    }
    
    /* ≈Åadne toggle switches */
    .toggle-container {
      width: 60px;
      height: 30px;
      margin-left: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .toggle-switch {
      position: relative;
      width: 50px;
      height: 25px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .3s;
      border-radius: 25px;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 19px;
      width: 19px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .toggle-switch input:checked + .toggle-slider {
      background-color: #4CAF50;
    }
    
    .toggle-switch input:focus + .toggle-slider {
      box-shadow: 0 0 1px #4CAF50;
    }
    
    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(25px);
    }
    
    .config-toggle {
      position: relative;
      width: 60px;
      height: 30px;
      margin-left: 20px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid red; /* DEBUG - powinno byƒá widoczne */
      background: yellow; /* DEBUG - powinno byƒá widoczne */
    }
    .config-toggle input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      opacity: 1;
      position: static;
      background-color: white;
      border: 2px solid #007bff;
      border-radius: 3px;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      z-index: 999; /* DEBUG - na wierzchu */
    }
    .config-toggle input[type="checkbox"]:checked {
      background-color: #007bff;
      border-color: #007bff;
    }
    .config-toggle input[type="checkbox"]:checked::before {
      content: '‚úì';
      color: white;
      font-size: 14px;
      font-weight: bold;
      display: block;
      text-align: center;
      line-height: 16px;
    }
    .save-button {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 20px;
    }
    .save-button:hover {
      background: #0056b3;
    }
    .save-button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .status-message {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      display: none;
    }
    .status-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .back-button {
      background: #6c757d;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      margin-bottom: 20px;
    }
    .back-button:hover {
      background: #545b62;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <aside class="sidebar">
      <h2>MENU</h2>
      <ul>
        <li><a href="index.html">Pulpit</a></li>
        <li><a href="employees.html">Zesp√≥≈Ç</a></li>
        <li><span id="showSubmenu" style="cursor:pointer;font-weight:bold;">Obecno≈õƒá &#9654;</span></li>
        <li><a href="mobile_config.html" style="font-weight:bold;">Konfiguracja Aplikacji</a></li>
      </ul>
    </aside>
    <div id="submenuPanel" class="submenu-panel">
      <h3>Obecno≈õƒá</h3>
      <a href="attendance_day.html">Obecno≈õƒá ‚Äì Dzie≈Ñ</a>
      <a href="attendance_summary.html">Obecno≈õƒá ‚Äì Ewidencja</a>
    </div>
    <main class="main-content" style="margin-left:200px;">
      <a href="index.html" class="back-button">‚Üê Wstecz</a>
      
      <h1>üîß Konfiguracja Aplikacji Mobilnej</h1>
      <p>ZarzƒÖdzaj funkcjami aplikacji mobilnej dla pracownik√≥w. Zmiany bƒôdƒÖ widoczne po ponownym uruchomieniu aplikacji.</p>
      
      <div id="statusMessage" class="status-message"></div>
      
      <div class="config-section">
        <h2>‚è±Ô∏è Funkcje Czasowe</h2>
        
        <div class="config-row">
          <div class="config-label">Timer pracy</div>
          <div class="config-description">Wy≈õwietla licznik czasu od rozpoczƒôcia pracy</div>
          <div class="toggle-container">
            <label class="toggle-switch">
              <input type="checkbox" id="timer_enabled">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
        
        <div class="config-row">
          <div class="config-label">Statystyki dzienne</div>
          <div class="config-description">Pokazuje statystyki pracy w aplikacji</div>
          <div class="toggle-container">
            <label class="toggle-switch">
              <input type="checkbox" id="daily_stats">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
        
        <div class="config-row">
          <div class="config-label">Statystyki miesiƒôczne</div>
          <div class="config-description">Wy≈õwietla podsumowanie miesiƒôczne</div>
          <div class="toggle-container">
            <label class="toggle-switch">
              <input type="checkbox" id="monthly_stats">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>
      
      <div class="config-section">
        <h2>üîí Bezpiecze≈Ñstwo</h2>
        
        <div class="config-row">
          <div class="config-label">Blokada p√≥l podczas pracy</div>
          <div class="config-description">Zablokuj edycjƒô numeru pracownika podczas trwajƒÖcej pracy</div>
          <div class="toggle-container">
            <label class="toggle-switch">
              <input type="checkbox" id="field_blocking">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
        
        <div class="config-row">
          <div class="config-label">Weryfikacja GPS</div>
          <div class="config-description">Wymagaj aktywnej lokalizacji do rejestracji</div>
          <div class="toggle-container">
            <label class="toggle-switch">
              <input type="checkbox" id="gps_verification">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>
      
      <div class="config-section">
        <h2>üì± Interfejs</h2>
        
        <div class="config-row">
          <div class="config-label">Widget na pulpit</div>
          <div class="config-description">Umo≈ºliwia dodanie widgetu na ekran g≈Ç√≥wny telefonu</div>
          <div class="toggle-container">
            <label class="toggle-switch">
              <input type="checkbox" id="widget_support">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
        
        <div class="config-row">
          <div class="config-label">Powiadomienia</div>
          <div class="config-description">Wysy≈Çaj powiadomienia o wa≈ºnych wydarzeniach</div>
          <div class="toggle-container">
            <label class="toggle-switch">
              <input type="checkbox" id="notifications">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
        
        <div class="config-row">
          <div class="config-label">Tryb offline</div>
          <div class="config-description">Zezwalaj na pracƒô bez po≈ÇƒÖczenia internetowego</div>
          <div class="toggle-container">
            <label class="toggle-switch">
              <input type="checkbox" id="offline_mode">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>
      
      <div class="config-section">
        <h2>üîß Zaawansowane</h2>
        
        <div class="config-row">
          <div class="config-label">Debug mode</div>
          <div class="config-description">Pokazuje dodatkowe informacje techniczne</div>
          <div class="toggle-container">
            <label class="toggle-switch">
              <input type="checkbox" id="debug_mode">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
        
        <div class="config-row">
          <div class="config-label">Auto-aktualizacje</div>
          <div class="config-description">Automatyczne sprawdzanie i powiadomienia o aktualizacjach</div>
          <div class="toggle-container">
            <label class="toggle-switch">
              <input type="checkbox" id="auto_updates">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>
      
      <div class="config-section">
        <h2>üì± ZarzƒÖdzanie Aktualizacjami</h2>
        
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
          <h4 style="margin: 0 0 10px 0;">üöÄ Informacje o wersji aplikacji</h4>
          <p><strong>Aktualna wersja w sklepie:</strong> <span id="currentPlayStoreVersion">≈Åadowanie...</span></p>
          <p><strong>Minimalna wymagana wersja:</strong> <span id="minimumVersion">≈Åadowanie...</span></p>
          <p><strong>URL do Play Store:</strong> <br>
            <input type="text" id="playStoreUrl" style="width: 100%; padding: 5px; margin-top: 5px;" placeholder="https://play.google.com/store/apps/details?id=...">
          </p>
          <p><strong>Komunikat o aktualizacji:</strong><br>
            <textarea id="updateMessage" style="width: 100%; padding: 5px; margin-top: 5px; height: 60px;" placeholder="Dostƒôpna nowa wersja aplikacji..."></textarea>
          </p>
        </div>
        
        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px solid #ffeaa7;">
          <h4 style="margin: 0 0 10px 0;">‚ö†Ô∏è Opcje zarzƒÖdzania</h4>
          <label style="display: block; margin-bottom: 10px;">
            <input type="checkbox" id="forceUpdate"> Wymu≈õ aktualizacjƒô (aplikacja nie bƒôdzie dzia≈Çaƒá bez aktualizacji)
          </label>
          <button onclick="saveVersionInfo()" style="background: #ffc107; color: #212529; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
            üíæ Zapisz ustawienia wersji
          </button>
        </div>
      </div>
      
      <button class="save-button" onclick="saveConfiguration()">üíæ Zapisz Konfiguracjƒô</button>
      
      <div style="margin-top: 40px; padding: 15px; background: #f8f9fa; border-radius: 4px;">
        <h3>‚ÑπÔ∏è Informacje</h3>
        <p><strong>Wersja konfiguracji:</strong> <span id="configVersion">≈Åadowanie...</span></p>
        <p><strong>Ostatnia aktualizacja:</strong> <span id="lastUpdate">≈Åadowanie...</span></p>
        <p><strong>Status serwera:</strong> <span id="serverStatus">Sprawdzanie...</span></p>
      </div>
    </main>
  </div>
  
  <script>
    let currentConfig = {};
    
    // Za≈Çaduj aktualnƒÖ konfiguracjƒô
    async function loadConfiguration() {
      try {
        const response = await fetch('http://127.0.0.1:8002/mobile-config');
        if (!response.ok) throw new Error('B≈ÇƒÖd serwera');
        
        const data = await response.json();
        currentConfig = data.config;
        
        // Wype≈Çnij formularz
        Object.keys(currentConfig).forEach(key => {
          const checkbox = document.getElementById(key);
          if (checkbox) {
            checkbox.checked = currentConfig[key] === true;
          }
        });
        
        // Aktualizuj informacje
        document.getElementById('configVersion').textContent = data.version || 'Nieznana';
        document.getElementById('lastUpdate').textContent = new Date(data.timestamp).toLocaleString('pl-PL');
        document.getElementById('serverStatus').textContent = '‚úÖ Po≈ÇƒÖczony';
        document.getElementById('serverStatus').style.color = 'green';
        
        // Za≈Çaduj informacje o wersji
        await loadVersionInfo();
        
      } catch (error) {
        console.error('B≈ÇƒÖd ≈Çadowania konfiguracji:', error);
        document.getElementById('serverStatus').textContent = '‚ùå B≈ÇƒÖd po≈ÇƒÖczenia';
        document.getElementById('serverStatus').style.color = 'red';
        showMessage('B≈ÇƒÖd ≈Çadowania konfiguracji: ' + error.message, 'error');
      }
    }
    
    // Za≈Çaduj informacje o wersji aplikacji
    async function loadVersionInfo() {
      try {
        const response = await fetch('http://127.0.0.1:8002/app-version');
        if (!response.ok) throw new Error('B≈ÇƒÖd serwera');
        
        const data = await response.json();
        const versionInfo = data.version_info;
        
        // Wype≈Çnij pola
        document.getElementById('currentPlayStoreVersion').textContent = versionInfo.current_version;
        document.getElementById('minimumVersion').textContent = versionInfo.minimum_version;
        document.getElementById('playStoreUrl').value = versionInfo.play_store_url;
        document.getElementById('updateMessage').value = versionInfo.update_message;
        document.getElementById('forceUpdate').checked = versionInfo.update_required;
        
      } catch (error) {
        console.error('B≈ÇƒÖd ≈Çadowania informacji o wersji:', error);
      }
    }
    
    // Zapisz informacje o wersji
    async function saveVersionInfo() {
      try {
        const versionData = {
          current_version: document.getElementById('currentPlayStoreVersion').textContent,
          minimum_version: document.getElementById('minimumVersion').textContent,
          play_store_url: document.getElementById('playStoreUrl').value,
          update_message: document.getElementById('updateMessage').value,
          update_required: document.getElementById('forceUpdate').checked
        };
        
        // W rzeczywistej implementacji tutaj by≈Çby POST do zapisania wersji
        showMessage('‚úÖ Ustawienia wersji zosta≈Çy zapisane!', 'success');
        
      } catch (error) {
        showMessage('‚ùå B≈ÇƒÖd podczas zapisywania ustawie≈Ñ wersji: ' + error.message, 'error');
      }
    }
    
    // Zapisz konfiguracjƒô
    async function saveConfiguration() {
      const saveButton = document.querySelector('.save-button');
      saveButton.disabled = true;
      saveButton.textContent = '‚è≥ Zapisywanie...';
      
      try {
        // Zbierz dane z formularza
        const newConfig = {};
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        
        checkboxes.forEach(checkbox => {
          newConfig[checkbox.id] = checkbox.checked;
        });
        
        // Wy≈õlij do serwera
        const response = await fetch('http://127.0.0.1:8002/mobile-config', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(newConfig)
        });
        
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.detail || 'B≈ÇƒÖd serwera');
        }
        
        const result = await response.json();
        showMessage('‚úÖ Konfiguracja zosta≈Ça zapisana pomy≈õlnie!', 'success');
        
        // Od≈õwie≈º konfiguracjƒô
        await loadConfiguration();
        
      } catch (error) {
        console.error('B≈ÇƒÖd zapisywania:', error);
        showMessage('‚ùå B≈ÇƒÖd podczas zapisywania konfiguracji: ' + error.message, 'error');
      } finally {
        saveButton.disabled = false;
        saveButton.textContent = 'üíæ Zapisz Konfiguracjƒô';
      }
    }
    
    // Poka≈º wiadomo≈õƒá status
    function showMessage(message, type) {
      const statusDiv = document.getElementById('statusMessage');
      statusDiv.textContent = message;
      statusDiv.className = `status-message status-${type}`;
      statusDiv.style.display = 'block';
      
      // Ukryj po 5 sekundach
      setTimeout(() => {
        statusDiv.style.display = 'none';
      }, 5000);
    }
    
    // Sidebar handling
    const showSubmenu = document.getElementById('showSubmenu');
    const submenuPanel = document.getElementById('submenuPanel');
    if (showSubmenu && submenuPanel) {
      showSubmenu.onclick = function() {
        submenuPanel.classList.toggle('active');
        document.body.classList.toggle('submenu-open', submenuPanel.classList.contains('active'));
      };
      document.addEventListener('click', function(e) {
        if (!submenuPanel.contains(e.target) && e.target !== showSubmenu) {
          submenuPanel.classList.remove('active');
          document.body.classList.remove('submenu-open');
        }
      });
    }
    
    // Za≈Çaduj konfiguracjƒô po za≈Çadowaniu strony
    document.addEventListener('DOMContentLoaded', loadConfiguration);
  </script>
</body>
</html>
