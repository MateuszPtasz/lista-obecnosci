<!-- STATUS MESSAGE COMPONENT -->
<div class="status-message-component" id="status-message-component">
    <style>
        /* Status Message Component Styles */
        .status-message-component {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .status-message {
            min-width: 300px;
            max-width: 500px;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 10px;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .status-message.show {
            transform: translateX(0);
            opacity: 1;
        }

        .status-message.hide {
            transform: translateX(100%);
            opacity: 0;
        }

        /* Success Messages */
        .status-message.success {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.95), rgba(69, 160, 73, 0.95));
            color: white;
            border-left: 4px solid #4CAF50;
        }

        /* Error Messages */
        .status-message.error {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.95), rgba(211, 47, 47, 0.95));
            color: white;
            border-left: 4px solid #f44336;
        }

        /* Warning Messages */
        .status-message.warning {
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.95), rgba(245, 124, 0, 0.95));
            color: white;
            border-left: 4px solid #FF9800;
        }

        /* Info Messages */
        .status-message.info {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.95), rgba(25, 118, 210, 0.95));
            color: white;
            border-left: 4px solid #2196F3;
        }

        /* Loading Messages */
        .status-message.loading {
            background: linear-gradient(135deg, rgba(158, 158, 158, 0.95), rgba(117, 117, 117, 0.95));
            color: white;
            border-left: 4px solid #9E9E9E;
        }

        /* Message content */
        .message-content {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .message-icon {
            font-size: 20px;
            margin-top: 2px;
            flex-shrink: 0;
        }

        .message-text {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
        }

        .message-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }

        /* Close button */
        .close-button {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 16px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .close-button:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Progress bar for loading */
        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 0 0 12px 12px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            width: 0;
            transition: width 0.3s ease;
            border-radius: 0 0 12px 12px;
        }

        /* Loading spinner */
        .loading-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-top: 2px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .status-message-component {
                left: 10px;
                right: 10px;
                top: 10px;
            }

            .status-message {
                min-width: unset;
                max-width: unset;
                width: 100%;
            }

            .message-text {
                font-size: 13px;
            }

            .message-title {
                font-size: 14px;
            }
        }

        /* Animation for stacked messages */
        .status-message:nth-child(2) {
            transform: translateY(-10px) scale(0.98);
            opacity: 0.8;
            z-index: -1;
        }

        .status-message:nth-child(3) {
            transform: translateY(-20px) scale(0.96);
            opacity: 0.6;
            z-index: -2;
        }
    </style>

    <!-- Messages container - messages will be dynamically added here -->
</div>

<script>
class StatusMessageClass {
    constructor() {
        this.container = document.querySelector('.status-message-component');
        this.messages = [];
        this.maxMessages = 5;
        this.defaultDuration = 5000;
        
        // Initialize container if not exists
        if (!this.container) {
            this.createContainer();
        }
    }

    createContainer() {
        const container = document.createElement('div');
        container.className = 'status-message-component';
        container.id = 'status-message-component';
        document.body.appendChild(container);
        this.container = container;
    }

    /**
     * Show success message
     * @param {string} message - Message text
     * @param {Object} options - Additional options
     */
    success(message, options = {}) {
        return this.show(message, 'success', {
            icon: 'fas fa-check-circle',
            title: options.title || 'Sukces!',
            ...options
        });
    }

    /**
     * Show error message
     * @param {string} message - Message text
     * @param {Object} options - Additional options
     */
    error(message, options = {}) {
        return this.show(message, 'error', {
            icon: 'fas fa-exclamation-circle',
            title: options.title || 'Błąd!',
            duration: options.duration || 8000, // Longer duration for errors
            ...options
        });
    }

    /**
     * Show warning message
     * @param {string} message - Message text
     * @param {Object} options - Additional options
     */
    warning(message, options = {}) {
        return this.show(message, 'warning', {
            icon: 'fas fa-exclamation-triangle',
            title: options.title || 'Ostrzeżenie!',
            ...options
        });
    }

    /**
     * Show info message
     * @param {string} message - Message text
     * @param {Object} options - Additional options
     */
    info(message, options = {}) {
        return this.show(message, 'info', {
            icon: 'fas fa-info-circle',
            title: options.title || 'Informacja',
            ...options
        });
    }

    /**
     * Show loading message
     * @param {string} message - Message text
     * @param {Object} options - Additional options
     */
    loading(message, options = {}) {
        return this.show(message, 'loading', {
            icon: 'loading-spinner',
            title: options.title || 'Ładowanie...',
            duration: 0, // Don't auto-hide loading messages
            showProgress: options.showProgress || false,
            ...options
        });
    }

    /**
     * Main show method
     * @param {string} message - Message text
     * @param {string} type - Message type (success, error, warning, info, loading)
     * @param {Object} options - Additional options
     */
    show(message, type = 'info', options = {}) {
        const messageId = this.generateId();
        const duration = options.duration !== undefined ? options.duration : this.defaultDuration;

        // Create message element
        const messageElement = this.createMessageElement(messageId, message, type, options);
        
        // Add to container
        this.container.appendChild(messageElement);
        this.messages.push({ id: messageId, element: messageElement, type, options });

        // Remove old messages if too many
        this.limitMessages();

        // Show message with animation
        setTimeout(() => {
            messageElement.classList.add('show');
        }, 10);

        // Auto-hide if duration is set
        if (duration > 0) {
            setTimeout(() => {
                this.hide(messageId);
            }, duration);
        }

        // Update progress bar if loading
        if (type === 'loading' && options.showProgress) {
            this.updateProgress(messageId, options.progress || 0);
        }

        return messageId;
    }

    /**
     * Create message DOM element
     */
    createMessageElement(id, message, type, options) {
        const element = document.createElement('div');
        element.className = `status-message ${type}`;
        element.dataset.id = id;

        let iconHtml = '';
        if (options.icon === 'loading-spinner') {
            iconHtml = '<div class="loading-spinner"></div>';
        } else if (options.icon) {
            iconHtml = `<i class="${options.icon} message-icon"></i>`;
        }

        const titleHtml = options.title ? `<div class="message-title">${options.title}</div>` : '';
        const progressHtml = options.showProgress ? '<div class="progress-bar"><div class="progress-fill"></div></div>' : '';

        element.innerHTML = `
            <div class="message-content">
                ${iconHtml}
                <div class="message-text">
                    ${titleHtml}
                    <div>${message}</div>
                </div>
            </div>
            <button class="close-button" onclick="StatusMessage.hide('${id}')">
                <i class="fas fa-times"></i>
            </button>
            ${progressHtml}
        `;

        return element;
    }

    /**
     * Hide specific message
     * @param {string} messageId - Message ID to hide
     */
    hide(messageId) {
        const messageData = this.messages.find(m => m.id === messageId);
        if (messageData) {
            messageData.element.classList.add('hide');
            
            setTimeout(() => {
                if (messageData.element.parentNode) {
                    messageData.element.parentNode.removeChild(messageData.element);
                }
                this.messages = this.messages.filter(m => m.id !== messageId);
            }, 300);
        }
    }

    /**
     * Hide all messages
     */
    hideAll() {
        this.messages.forEach(messageData => {
            messageData.element.classList.add('hide');
        });
        
        setTimeout(() => {
            this.container.innerHTML = '';
            this.messages = [];
        }, 300);
    }

    /**
     * Update progress for loading message
     * @param {string} messageId - Message ID
     * @param {number} progress - Progress percentage (0-100)
     */
    updateProgress(messageId, progress) {
        const messageData = this.messages.find(m => m.id === messageId);
        if (messageData) {
            const progressFill = messageData.element.querySelector('.progress-fill');
            if (progressFill) {
                progressFill.style.width = `${Math.min(100, Math.max(0, progress))}%`;
            }
        }
    }

    /**
     * Update loading message text
     * @param {string} messageId - Message ID
     * @param {string} newMessage - New message text
     */
    updateMessage(messageId, newMessage) {
        const messageData = this.messages.find(m => m.id === messageId);
        if (messageData) {
            const textElement = messageData.element.querySelector('.message-text div:last-child');
            if (textElement) {
                textElement.textContent = newMessage;
            }
        }
    }

    /**
     * Complete loading message (convert to success)
     * @param {string} messageId - Message ID
     * @param {string} successMessage - Success message
     */
    completeLoading(messageId, successMessage = 'Ukończono!') {
        const messageData = this.messages.find(m => m.id === messageId);
        if (messageData && messageData.type === 'loading') {
            // Update message
            this.updateMessage(messageId, successMessage);
            
            // Change to success style
            messageData.element.className = 'status-message success show';
            
            // Update icon
            const iconElement = messageData.element.querySelector('.loading-spinner');
            if (iconElement) {
                iconElement.outerHTML = '<i class="fas fa-check-circle message-icon"></i>';
            }
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                this.hide(messageId);
            }, 3000);
            
            messageData.type = 'success';
        }
    }

    /**
     * Limit number of visible messages
     */
    limitMessages() {
        while (this.messages.length > this.maxMessages) {
            const oldest = this.messages[0];
            this.hide(oldest.id);
        }
    }

    /**
     * Generate unique message ID
     */
    generateId() {
        return 'msg-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
    }

    /**
     * Legacy compatibility method
     * @param {string} message - Message text
     * @param {string} type - Message type
     * @param {number} duration - Duration in milliseconds
     */
    showMessage(message, type = 'info', duration = 5000) {
        return this.show(message, type, { duration });
    }
}

// Initialize global instance
window.StatusMessage = new StatusMessageClass();

// Legacy global function for backward compatibility
window.showMessage = (message, type, duration) => {
    return window.StatusMessage.showMessage(message, type, duration);
};
</script>
